name: Auto Sync SeerAPI to CNB

# 触发条件：
# 1. 定时触发：每4小时一次 (UTC时间)
# 2. 手动触发：点击按钮立即运行
on:
  schedule:
    - cron: '0 */4 * * *'
  workflow_dispatch:

jobs:
  sync-all-repos:
    runs-on: ubuntu-latest
    steps:
      # ==============================
      # 任务 1: config-sources
      # ==============================
      - name: Sync config-sources
        run: |
          echo "正在同步 config-sources..."
          # 1. 克隆源仓库 (镜像模式)
          git clone --mirror https://github.com/SeerAPI/config-sources.git repo1
          cd repo1
          # 2. 设置 CNB 目标地址
          git remote add cnb "https://oauth2:${{ secrets.CNB_TOKEN }}@cnb.cool/seer_unity/config-sources.git"
          # 3. 强制推送
          git push cnb --mirror
          # 4. 清理
          cd ..
          rm -rf repo1
          echo "config-sources 同步完成 ✅"

      # ==============================
      # 任务 2: seer-unity-assets
      # ==============================
      - name: Sync seer-unity-assets
        run: |
          echo "正在同步 seer-unity-assets..."
          git clone --mirror https://github.com/SeerAPI/seer-unity-assets.git repo2
          cd repo2
          git remote add cnb "https://oauth2:${{ secrets.CNB_TOKEN }}@cnb.cool/seer_unity/seer-unity-assets.git"
          git push cnb --mirror
          cd ..
          rm -rf repo2
          echo "seer-unity-assets 同步完成 ✅"

      # ==============================
      # 任务 3: api-data
      # ==============================
      - name: Sync api-data
        run: |
          echo "正在同步 api-data..."
          git clone --mirror https://github.com/SeerAPI/api-data.git repo3
          cd repo3
          git remote add cnb "https://oauth2:${{ secrets.CNB_TOKEN }}@cnb.cool/seer_unity/api-data.git"
          git push cnb --mirror
          cd ..
          rm -rf repo3
          echo "api-data 同步完成 ✅"
